/** 
 * controller.min.js
 *
 * @fileoverview AngularJS controller for X Sound Application
 * 
 * JavaScript Libraries :
 *     XSound.js (https://github.com/Korilakkuma/XSound)
 *     jQuery / jQuery UI
 *     select2.js
 *
 * Copyright 2012, 2013, 2014@Tomohiro IKEDA
 * Released under the MIT license
 */
(function(){var g=angular.module("xsound",[]);g.config(["$compileProvider",function(b){b.aHrefSanitizationWhitelist(/^\s*(https?|data|blob):/)}]);g.factory("BASE_URL",["$location",function(b){var a="";return a="localhost"===b.host()?b.protocol()+"://"+b.host()+"/~rilakkuma3xjapan/portfolio-x-sound/resources/":b.protocol()+"://"+b.host()+"/X-Sound/resources/"}]);g.value("sources",["mixer","oscillator","oneshot","audio","stream"]);g.value("updateParamEachOscillator",function(b,a,c,d){var e=[0,1,2,3];
switch(b){case 0:a?angular.forEach(e,function(b){X("oscillator",b).module(a).param(c,d)}):angular.forEach(e,function(a){X("oscillator",a).param(c,d)});break;case 1:a?angular.forEach(e,function(b){C("oscillator",b).module(a).param(c,d)}):angular.forEach(e,function(a){C("oscillator",a).param(c,d)})}});g.value("updateParamOfModule",function(b,a,c,d){"oscillator"===b&&"eg"===a?(X("oscillator").module("eg").param(c,d),C("oscillator").module("eg").param(c,d)):"analyser"===a&&"interval"===c?0<d?(X(b).module("analyser").domain("time").param("interval",
d),X(b).module("analyser").domain("fft").param("interval",d)):(X(b).module("analyser").domain("time").param("interval","auto"),X(b).module("analyser").domain("fft").param("interval","auto")):(X(b).module(a).param(c,d),"oscillator"===b&&C("oscillator").module(a).param(c,d))});g.value("updateParamOfSource",function(b,a,c){"oneshot"===b&&"playbackRate"===a?X("oneshot").param("transpose",c):(X(b).param(a,c),C("oscillator").param(a,c))});g.factory("updateParam",["updateParamEachOscillator","updateParamOfModule",
"updateParamOfSource",function(b,a,c){return function(d,e,k,f){var h=[],h=d?d.split(" "):["mixer","oscillator","oneshot","audio","stream"];angular.forEach(h,function(h){var d=h.match(/oscillator(0|1)/);null!==d?b(parseInt(d[1]),e,k,f):e?a(h,e,k,f):c(h,k,f)})}}]);g.value("openDialog",function(b,a,c,d,e){$("<div />").html(e).dialog({title:b,autoOpen:!0,show:"explode",hide:"explode",width:a,height:c,modal:d,draggable:!0,resizable:!1,buttons:{OK:function(){$(this).dialog("close").dialog("destroy").remove()}}})});
g.factory("readFile",["openDialog",function(b){return function(a){try{var c=X.file(a)}catch(d){b("Error",500,"auto",!0,"<p><b>"+d.message+"</b></p>")}return c}}]);g.factory("readFileByDragAndDrop",["readFile",function(b){return function(a,c){a.addEventListener("dragenter",function(a){a.preventDefault();$(this).removeClass("drag-off").addClass("drag-on")});a.addEventListener("dragover",function(a){a.preventDefault()});a.addEventListener("dragleave",function(a){$(this).removeClass("drag-on").addClass("drag-off")});
a.addEventListener("drop",function(a){$(this).removeClass("drag-on").addClass("drag-off");c.event=a;a=b(c);a instanceof Blob&&(this.value=a.name)})}}]);g.factory("readFileErrorCallback",["openDialog",function(b){return function(a){var c="";switch(a){case "FILE_IS_NOT_BLOB":c="The designated file is not Blob";break;case "NOT_FOUND_ERR":c="There is not file";break;case "SECURITY_ERR":c="Security error occurred";break;case "ABORT_ERR":c="Abort";break;case "NOT_READABLE_ERR":c="The authority to read file does not exists";
break;case "ENCODING_ERR":c="FIle size exceeds limit";break;case "ERR":c="Error. Please try again."}b("Error",500,"auto",!0,"<p><b>"+c+"</b></p>")}}]);g.value("readFileProgressCallback",function(b,a,c){var d=0,e="";c.lengthComputable&&0<c.total&&(d=Math.floor(c.loaded/c.total*100),e=c.loaded+" Bytes load ("+d+" %)",a(function(){b.readFileProgress=e;b.isModalProgressReadFile||(b.isModalProgressReadFile=!0)}))});g.value("drawNodeCallback",function(b,a,c){if(0<=c&&c<=X("audio").param("duration")){X("audio").param("currentTime",
c);X("audio").module("analyser").domain("time-all-L").update(c);X("audio").module("analyser").domain("time-all-R").update(c);var d=X.convertTime(c);a(function(){b.currentTime=c;b.currentTimeText=("0"+d.minutes).slice(-2)+" : "+("0"+d.seconds).slice(-2)+"."+String(d.milliseconds).slice(2,4)})}});g.value("createDateTimeString",function(){var b=function(a){return("0"+a).slice(-2)},a=new Date,c=a.getFullYear(),d=b(a.getMonth()+1),e=b(a.getDate()),k=b(a.getHours()),f=b(a.getMinutes()),b=b(a.getSeconds());
return c+d+e+k+f+b});g.run(["$rootScope","$window","sources","openDialog",function(b,a,c,d){X.IS_XSOUND?(b.isActives={},b.isActives.visualization=!1,b.isActives.mml=!1,a.C=X.clone(),X.free([X("media"),X("fallback"),C("mixer"),C("oneshot"),C("audio"),C("media"),C("fallback")]),X("mixer").resize(4096),X("oscillator").resize(4096),C("oscillator").resize(4096),X("oneshot").resize(4096),X("audio").resize(8192),X("stream").resize(512),X("oscillator").setup([!0,!1,!1,!1]),C("oscillator").setup([!1,!1,!1,
!1]),X("stream").setup(!1,function(a){console.dir(a)},function(a){d("Confirmation",400,"auto",!0,"<p><b>Cancel Microphone.</b></p>");console.dir(a)}),angular.forEach(c,function(a){X(a).module("distortion").param("color",2E3);X(a).module("distortion").param("tone",4E3);X(a).module("chorus").param("tone",4E3);X(a).module("flanger").param("tone",4E3);X(a).module("delay").param("tone",4E3);X(a).module("reverb").param("tone",4E3);X(a).module("filter").param("frequency",8E3)}),C("oscillator").module("distortion").param("color",
2E3),C("oscillator").module("distortion").param("tone",4E3),C("oscillator").module("chorus").param("tone",4E3),C("oscillator").module("flanger").param("tone",4E3),C("oscillator").module("delay").param("tone",4E3),C("oscillator").module("reverb").param("tone",4E3),C("oscillator").module("filter").param("frequency",8E3)):d("Error",600,"auto",!0,"<p><b>Your Browser does not support Web Audio API. Please use Chrome, Opera, Firefox (Mac / Windows) or Safari (Mac).</b></p>")}]);g.directive("uiSlider",["updateParam",
function(b){return{restrict:"EA",template:"<div></div>",link:function(a,c,d,e,k){a=d.value;e=d.min;k=d.max;var f=d.step,h=d.range||"min",n=d.animate||"slow",g=d.source,l=d.module,m=d.param,q=l?l+"-"+m:m,r=function(a){b(g,l,m,a);$(".spinner-"+q).each(function(b,c){var h=$(c).parents("ui-spinner");h.attr("source")===g&&h.attr("module")===l&&("glide"!==l&&"time"===m&&(a*=Math.pow(10,3)),$(c).spinner("value",a))})};$(c).children("div").addClass("slider-"+q).slider({value:parseFloat(a),min:parseFloat(e),
max:parseFloat(k),step:parseFloat(f),range:h,animate:n,change:function(a,b){var c=parseFloat(b.value);"glide"!==l&&"time"===m&&(c/=Math.pow(10,3));r(c)},slide:function(a,b){var c=parseFloat(b.value);"glide"!==l&&"time"===m&&(c/=Math.pow(10,3));r(c)}})}}}]);g.directive("uiSpinner",["updateParam",function(b){return{restrict:"EA",template:"<input />",link:function(a,c,d,e,k){a=d.value;e=d.min;k=d.max;var f=d.step,h=d.source,n=d.module,g=d.param,l=n?n+"-"+g:g,m=function(a){b(h,n,g,a);$(".slider-"+l).each(function(b,
c){var d=$(c).parent("ui-slider");d.attr("source")===h&&d.attr("module")===n&&("glide"!==n&&"time"===g&&(a*=Math.pow(10,3)),$(c).slider("value",a))})};$(c).children("input").addClass("spinner-"+l).spinner({min:parseFloat(e),max:parseFloat(k),step:parseFloat(f),spin:function(a,b){var c=parseFloat(b.value);"glide"!==n&&"time"===g&&(c/=Math.pow(10,3));m(c)}}).spinner("value",parseFloat(a))}}}]);g.directive("uiSliderTime",[function(){return{restrict:"EA",template:"<div></div>",link:function(b,a,c,d,e){d=
c.value;e=c.max;var k=c.step,f=c.range||"min";c=c.animate||"slow";$(a).children("div").attr("id","slider-audio-current-time").slider({value:parseFloat(d),min:0,max:parseFloat(e),step:parseFloat(k),range:f,animate:c,change:function(a,b){},slide:function(a,b){X("audio").param("currentTime",parseFloat(b.value))}});b.$watch(function(){return b.duration},function(a){$("#slider-audio-current-time").slider("option","max",a);$("#spinner-audio-current-time").spinner("option","max",a)});b.$watch(function(){return b.currentTime},
function(a){$("#slider-audio-current-time").slider("value",a);$("#spinner-audio-current-time").spinner("value",a)})}}}]);g.directive("uiSpinnerTime",[function(){return{restrict:"EA",template:"<input />",link:function(b,a,c,d,e){b=c.value;d=c.max;c=c.step;$(a).children("input").attr("id","spinner-audio-current-time").spinner({min:0,max:parseFloat(d),step:parseFloat(c),spin:function(a,b){X("audio").param("currentTime",parseFloat(b.value))}}).spinner("value",parseFloat(b))}}}]);g.directive("uiToggleEffector",
["sources",function(b){return{restrict:"A",link:function(a,c,d,e,k){var f=d.effector,h=parseInt(d.state);0!==h&&1!==h||angular.forEach(b,function(a){X(a).module(f).state(Boolean(h));C("oscillator").module(f).state(Boolean(h));X(a).module(f).state()?$(c).addClass("check-on"):$(c).removeClass("check-on")});$(c).on("click",function(){angular.forEach(b,function(a){X(a).module(f).state()?(X(a).module(f).state(!1),C("oscillator").module(f).state(!1),$(c).removeClass("check-on")):(X(a).module(f).state(!0),
C("oscillator").module(f).state(!0),$(c).addClass("check-on"))})})}}}]);g.directive("uiModalProgress",[function(){return{restrict:"EA",link:function(b,a,c,d,e){$(a).css({position:"fixed",top:"0px",left:"0px","z-index":9999,padding:"15% 0%",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.6)"})}}}]);g.directive("uiTooltip",function(){return{restrict:"A",link:function(b,a,c,d,e){$(a).tooltip({tooltipClass:"ui-tooltip-custom"})}}});g.directive("uiSortable",function(){return{restrict:"A",
link:function(b,a,c,d,e){$(a).sortable({axis:"x",cancel:"fieldset, :input, button, label, a, #piano",cursor:"move",opacity:.6})}}});g.directive("uiSelect",["$timeout","sources",function(b,a){return{restrict:"A",link:function(c,d,e,k,f){$(d).select2();switch($(d).attr("id")){case "select-sound-source":$(d).on("change",function(){var a=this.value;switch(a){case "oscillator":X("stream").stop();b(function(){c.currentSoundSource=a});break;case "one-shot":c.isEnableOneshot&&b(function(){c.currentSoundSource=
a});X("stream").stop();break;case "microphone":try{X("stream").start(),X("stream").module("session").start()}catch(d){openDialog("Error",400,"auto",!0,"<p><b>"+d.message+"</b></p>"),b(function(){c.currentSoundSource=a})}break;case "midi":X("stream").stop()}});break;case "select-rec-track":$(d).on("change",function(){if(!c.isActive){var d=parseInt(this.value);b(function(){c.activeTrack=d});angular.forEach(a,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").ready(d)})}});break;case "select-visualization-api":$(d).on("change",
function(){c.selectAPI(this.value)});break;case "select-distortion-type":$(d).on("change",function(){var b=this.value;angular.forEach(a,function(a){X(a).module("distortion").param("curve",b)})});break;case "select-distortion-sample":$(d).on("change",function(){var b=this.value;angular.forEach(a,function(a){X(a).module("distortion").param("samples",b)})});break;case "select-filter-type":$(d).on("change",function(){var b=this.value;angular.forEach(a,function(a){X(a).module("filter").param("type",b)})});
break;case "select-phaser-stage":$(d).on("change",function(){var b=this.value;angular.forEach(a,function(a){X(a).module("phaser").param("stage",b)})});case "select-reverb-type":$(d).on("change",function(){var b=parseInt(this.value)-1;-1===b&&(b=null);angular.forEach(a,function(a){X(a).module("reverb").param("type",b)})})}}}}]);g.directive("slideBlock",["$rootScope",function(b){return{restrict:"A",link:function(a,c,d,e,k){var f=d.model;$(c).hide();a.$watch(function(){return b.isActives},function(a){a[f]?
$(c).slideDown(1E3,"easeOutQuint"):$(c).slideUp(1E3,"easeOutQuint")},!0)}}}]);g.directive("audioUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(b,a,c,d,e){return{restrict:"A",link:function(k,f,h,g,p){var l={event:null,type:"ArrayBuffer",success:function(a,c){X("audio").ready.call(X("audio"),c);b(function(){k.isModalProgressReadFile=!1})},error:function(a,b){e(b)},progress:function(a){d(k,b,a)}};f[0].addEventListener("change",function(b){l.event=
b;b=a(l);this.value="";b instanceof Blob&&$(f).next('[type="text"]').val(b.name)},!1);h=$(f).next('[type="text"]')[0];c(h,l)}}}]);g.directive("rirUploader",["$timeout","sources","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(b,a,c,d,e,k){return{restrict:"A",link:function(f,h,g,p,l){var m={event:null,type:"ArrayBuffer",success:function(c,d){angular.forEach(a,function(a){X(a).module("reverb").start.call(X(a).module("reverb"),d)});b(function(){f.isModalProgressReadFile=
!1})},error:function(a,b){k(b)},progress:function(a){e(f,b,a)}};h[0].addEventListener("change",function(a){m.event=a;a=c(m);this.value="";a instanceof Blob&&$(h).next('[type="text"]').val(a.name)},!1);g=$(h).next('[type="text"]')[0];d(g,m)}}}]);g.directive("mmlUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(b,a,c,d,e){return{restrict:"A",link:function(k,f,h,g,p){var l={event:null,type:"Text",success:function(a,c){var d=function(){b(function(){k.mml=
c;k.paused=!0;k.readyMML()})};""===k.mml?d():$("<div />").html("<p><b>MML already exists. Overwrite ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:500,height:"auto",draggable:!0,resizable:!1,buttons:{OK:function(){d();$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}});b(function(){k.isModalProgressReadFile=!1})},error:function(a,b){e(b)},progress:function(a){d(k,b,a)}};f[0].addEventListener("change",
function(b){l.event=b;b=a(l);this.value="";b instanceof Blob&&$(f).next('[type="text"]').val(b.name)},!1);h=$(f).next('[type="text"]')[0];c(h,l)}}}]);g.controller("XSoundController",["$rootScope","$scope","$window","$timeout","BASE_URL","sources","openDialog",function(b,a,c,d,e,k,f){var h=[e+"one-shot/piano-2/C.wav",e+"one-shot/piano-2/D.wav",e+"one-shot/piano-2/E.wav",e+"one-shot/piano-2/F.wav",e+"one-shot/piano-2/G.wav",e+"one-shot/piano-2/A.wav",e+"one-shot/piano-2/B.wav"],g=function(a){switch(parseInt((a+
9)%12)){case 0:case 1:return 0;case 2:case 3:return 1;case 4:return 2;case 5:case 6:return 3;case 7:case 8:return 4;case 9:case 10:return 5;case 11:return 6}},p=function(){for(var a=Array(88),b=0;88>b;b++){var c={buffer:0,rate:1,loop:!1,start:0,end:0,volume:1};c.buffer=g(b);var d=c,e=b,h=-1!==[1,4,6,9,11,13,16,18,21,23,25,28,30,33,35,37,40,42,45,47,49,52,54,57,59,61,64,66,69,71,73,76,78,81,83,85].indexOf(e)?!0:!1,f=0;0<=e&&2>=e?f=.0625:3<=e&&14>=e?f=.125:15<=e&&26>=e?f=.25:27<=e&&38>=e?f=.5:39<=e&&
50>=e?f=1:51<=e&&62>=e?f=2:63<=e&&74>=e?f=4:75<=e&&86>=e?f=8:87<=e&&98>=e&&(f=16);h&&(f*=Math.pow(2,1/12));d.rate=f;a[b]=c}return a},l=function(){d(function(){a.isReady=!0})},m=function(){var b=[];angular.forEach(a.rirs,function(c,d){X.ajax(c.url,6E4,function(c,d){X.decode(X.get(),d,function(c){b.push(c);a.$apply(function(){a.progress=Math.floor(b.length/a.rirs.length*100);a.progressStyle.width=a.progress+"%"});b.length===a.rirs.length&&(angular.forEach(k,function(a){X(a).module("reverb").preset(b)}),
C("oscillator").module("reverb").preset(b),l())},function(){l()})},function(a,b){f("Error",400,"auto",!0,"<p><b>The loading of RIRs failed.</b></p>")})})};try{X("oneshot").setup({resources:h,settings:p(),timeout:6E4,success:function(b,c){a.isEnableOneshot=!0;0===a.rirs.length?l():m()},error:function(a,b){f("Error",400,"height",!0,"<p><b>The loading of audio files failed.</b></p>")},progress:function(a){}})}catch(q){f("Error",400,"height",!0,"<p><b>"+q.message+"</b></p>")}a.currentSoundSource="oscillator";
a.isReady=!1;a.progress=0;a.progressStyle={width:a.progress+"%"};a.isSafari=function(){var a=navigator.userAgent.toLowerCase();return-1===a.indexOf("chrome")&&-1!==a.indexOf("safari")?!0:!1}();a.isEnableOneshot=!1;a.isEndOpeing=!1;a.isStart=!1;a.headerStyle={top:parseInt(c.innerHeight/4)+"px"};a.isModalProgressDecodeAudio=!1;a.isModalProgressReadFile=!1;a.isModalProgressSessionWait=!1;a.oscillators={};a.oscillators.oscillator0={};a.oscillators.oscillator0.isActive=!0;a.oscillators.oscillator0.type=
"sine";a.oscillators.oscillator1={};a.oscillators.oscillator1.isActive=!1;a.oscillators.oscillator1.type="sine";a.readFileProgress="";c=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")?[]:[{url:e+"impulse-responses/s1_r1_c.wav",value:1,label:"1 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r2_c.wav",value:2,label:"1 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r3_c.wav",value:3,
label:"1 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r4_c.wav",value:4,label:"1 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r1_c.wav",value:5,label:"2 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r2_c.wav",value:6,label:"2 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r3_c.wav",
value:7,label:"2 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r4_c.wav",value:8,label:"2 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r1_c.wav",value:9,label:"3 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r2_c.wav",value:10,label:"3 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r3_c.wav",
value:11,label:"3 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r4_c.wav",value:12,label:"3 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r1_o.wav",value:13,label:"1 - 1",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_r2_o.wav",value:14,label:"1 - 2",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_r3_o.wav",
value:15,label:"1 - 3",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_r4_o.wav",value:16,label:"1 - 4",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r1_o.wav",value:17,label:"2 - 1",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r2_o.wav",value:18,label:"2 - 2",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r3_o.wav",value:19,label:"2 - 3",
group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r4_o.wav",value:20,label:"2 - 4",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s3_r1_o.wav",value:21,label:"3 - 1",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s3_r2_o.wav",value:22,label:"3 - 2",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s3_r3_o.wav",value:23,label:"3 - 3",group:"Omnidirectional measurements in the audience area"},
{url:e+"impulse-responses/s3_r4_o.wav",value:24,label:"3 - 4",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_p1_o.wav",value:25,label:"1 - 1",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s1_p2_o.wav",value:26,label:"1 - 2",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s1_p3_o.wav",value:27,label:"1 - 3",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s2_p1_o.wav",value:28,
label:"2 - 1",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s2_p2_o.wav",value:29,label:"2 - 2",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s2_p3_o.wav",value:30,label:"2 - 3",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s3_p1_o.wav",value:31,label:"3 - 1",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s3_p2_o.wav",value:32,label:"3 - 2",group:"Omnidirectional measurements on the stage"},
{url:e+"impulse-responses/s3_p3_o.wav",value:33,label:"3 - 3",group:"Omnidirectional measurements on the stage"}];a.rirs=c;a.pianoKeyboards={};a.pianoKeyboards.keyboards={"A-4":0,"A-4h":1,"B-4":2,"C-3":3,"C-3h":4,"D-3":5,"D-3h":6,"E-3":7,"F-3":8,"F-3h":9,"G-3":10,"G-3h":11,"A-3":12,"A-3h":13,"B-3":14,"C-2":15,"C-2h":16,"D-2":17,"D-2h":18,"E-2":19,"F-2":20,"F-2h":21,"G-2":22,"G-2h":23,"A-2":24,"A-2h":25,"B-2":26,"C-1":27,"C-1h":28,"D-1":29,"D-1h":30,"E-1":31,"F-1":32,"F-1h":33,"G-1":34,"G-1h":35,"A-1":36,
"A-1h":37,"B-1":38,C:39,Ch:40,D:41,Dh:42,E:43,F:44,Fh:45,G:46,Gh:47,A:48,Ah:49,B:50,C1:51,C1h:52,D1:53,D1h:54,E1:55,F1:56,F1h:57,G1:58,G1h:59,A1:60,A1h:61,B1:62,C2:63,C2h:64,D2:65,D2h:66,E2:67,F2:68,F2h:69,G2:70,G2h:71,A2:72,A2h:73,B2:74,C3:75,C3h:76,D3:77,D3h:78,E3:79,F3:80,F3h:81,G3:82,G3h:83,A3:84,A3h:85,B3:86,C4:87};a.pianoKeyboards.whites="A-4 B-4 C-3 D-3 E-3 F-3 G-3 A-3 B-3 C-2 D-2 E-2 F-2 G-2 A-2 B-2 C-1 D-1 E-1 F-1 G-1 A-1 B-1 C D E F G A B C1 D1 E1 F1 G1 A1 B1 C2 D2 E2 F2 G2 A2 B2 C3 D3 E3 F3 G3 A3 B3 C4".split(" ");
a.pianoKeyboards.blacks="A-4h skip C-3h D-3h skip F-3h G-3h A-3h skip C-2h D-2h skip F-2h G-2h A-2h skip C-1h D-1h skip F-1h G-1h A-1h skip Ch Dh skip Fh Gh Ah skip C1h D1h skip F1h G1h A1h skip C2h D2h skip F2h G2h A2h skip C3h D3h skip F3h G3h A3h".split(" ");a.isSoundStops=[];angular.forEach(a.pianoKeyboards.keyboards,function(){a.isSoundStops.push(!0)});a.startApplication=function(b){b.preventDefault();a.isStart=!0;d(function(){a.isEndOpening=!0},2E3)};a.startSound=function(b,c){X.IS_XSOUND&&
!$(b.currentTarget).hasClass("skip")&&("oscillator"===a.currentSoundSource?(X("oscillator").ready(0,0).start(X.toFrequencies(c)),C("oscillator").ready(0,0).start(X.toFrequencies(c)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()):(X("oneshot").ready(0,0).start(c),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),a.isSoundStops[c]=!1)};a.stopSound=function(b,c){X.IS_XSOUND&&!$(b.currentTarget).hasClass("skip")&&
(b.stopPropagation(),"oscillator"===a.currentSoundSource?(X("oscillator").stop(),C("oscillator").stop()):X("oneshot").stop(c),a.isSoundStops[c]=!0)};a.clearKeyboards=function(){angular.forEach(a.isSoundStops,function(b,c){a.isSoundStops[c]=!0})};a.toggleOscillatorState=function(b,c){var d=!a.oscillators["oscillator"+c].isActive;switch(c){case 0:X("oscillator",0).state(d);break;case 1:C("oscillator",0).state(d)}a.oscillators["oscillator"+c].isActive=d};a.toggleAnalyserState=function(c){b.isActives.visualization=
!a.isActives.visualization;angular.forEach(k,function(a){"oscillator"!==a&&(X(a).module("analyser").domain("time").state(b.isActives.visualization),X(a).module("analyser").domain("fft").state(b.isActives.visualization))})};a.toggleMMLState=function(a){b.isActives.mml=!b.isActives.mml};a.changeWaveType=function(b,c,d){switch(c){case 0:X("oscillator",0).param("type",d);break;case 1:C("oscillator",0).param("type",d)}a.oscillators["oscillator"+c].type=d};a.triggerFileUploader=function(a){$(a.currentTarget).prev('[type="file"]').trigger("click")}}]);
g.controller("AudioController",["$scope","$timeout",function(b,a){X("audio").setup({decode:function(c){a(function(){b.$parent.isModalProgressDecodeAudio=!0})},ready:function(c){var d=c.duration;a(function(){b.$parent.isModalProgressDecodeAudio=!1;b.isActive=!1;b.duration=d;var a=X.convertTime(d);b.durationText=("0"+Math.floor(a.minutes)).slice(-2)+" : "+("0"+Math.floor(a.seconds)).slice(-2)+"."+String(a.milliseconds).slice(2,4);b.currentTimeText="00 : 00.00"})},start:function(c,d){X("audio").module("session").start();
a(function(){b.isActive=!0})},stop:function(c,d){a(function(){b.isActive=!1})},update:function(c,d){var e=X.convertTime(d);a(function(){b.currentTime=d;b.currentTimeText=("0"+e.minutes).slice(-2)+" : "+("0"+e.seconds).slice(-2)+"."+String(e.milliseconds).slice(2,4)})},ended:function(c,d){X("audio").module("analyser").domain("time-all-L").update(0);X("audio").module("analyser").domain("time-all-R").update(0);a(function(){b.isActive=!1;b.currentTime=0;b.currentTimeText="00 : 00.00"})}});b.currentTime=
0;b.currentTimeText="00 : 00.00";b.duration=0;b.durationText="00 : 00.00";b.isActive=!1;b.controlAudio=function(a){X("audio").toggle(X("audio").param("currentTime"))}}]);g.controller("RecordController",["$scope","$timeout","sources","openDialog","createDateTimeString",function(b,a,c,d,e){var k=function(){$("<div />").html("<p><b>Start recording in the TRACK "+(b.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",
draggable:!0,resizable:!1,buttons:{START:function(){angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").ready(b.activeTrack)});a(function(){b.isActive=!0});$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},f=function(){$("<div />").html("<p><b>Stop the recording. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,
resizable:!1,buttons:{STOP:function(){angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").stop()});a(function(){b.isActive=!1});$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})};b.isActive=!1;b.tracks=[1,2,3,4];b.activeTrack=0;b.objectURL="";b.finename="";angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").setup(b.tracks.length)});b.controlRecord=function(a){a.preventDefault();
b.isActive?f():k()};b.createWAVE=function(a){a.preventDefault();b.isActive||(a=b.$parent.currentSoundSource,"oscillator"===a&&(a="mixer"),b.objectURL=X(a).module("recorder").create("all",16,2,"blob"),b.objectURL&&(a=new Audio(b.objectURL),a.setAttribute("controls",!1),a.play()))};b.downloadWAVE=function(a){b.isActive?a.preventDefault():b.objectURL?b.filename="recorded-"+e()+".wav":(a.preventDefault(),d("Error",450,"auto",!0,"<p><b>The recorded sound data does not exists.</b></p>"))};b.clearTrack=
function(a){a.preventDefault();b.isActive||$("<div />").html("<p><b>Clear the TRACK "+(b.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,buttons:{CLEAR:function(){angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").clear(b.activeTrack)});$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})}}]);
g.controller("VisualizationController",["$rootScope","$scope","$timeout","sources","drawNodeCallback",function(b,a,c,d,e){a.api="canvas";a.channel="left";a.setRealTimeAnalyser=function(a,b){X(a).module("analyser").param({fftSize:2048,minDecibels:-100,maxDecibels:-30,smoothingTimeConstant:.1});X(a).module("analyser").domain("time").setup(b,b+"-time","svg-parent-time").param({interval:500,shape:"line",wave:"rgba(0, 0, 255, 1.0)",font:"12px Times New Roman",width:2,right:0});X(a).module("analyser").domain("fft").setup(b,
b+"-spectrum","svg-parent-spectrum").param({interval:500,shape:"rect",wave:"canvas"===b?"gradient":"rgba(0, 0, 255, 1.0)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],font:"12px Times New Roman",width:2,right:0,type:"uint",size:256})};a.setAnalyser=function(a){X("audio").module("analyser").domain("time-all-L").setup(a,a+"-time-all-L","svg-parent-L").state(!0).param({shape:"canvas"===a?"rect":"line",wave:"canvas"===a?"gradient":"rgba(0, 0, 255, 1.0)",grad:[{offset:0,
color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],font:"12px Times New Roman",width:.5,right:0});X("audio").module("analyser").domain("time-all-R").setup(a,a+"-time-all-R","svg-parent-R").state(!0).param({shape:"canvas"===a?"rect":"line",wave:"canvas"===a?"gradient":"rgba(0, 0, 255, 1.0)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],font:"12px Times New Roman",width:.5,right:0})};a.selectAPI=function(b){a.api=b;angular.forEach(d,function(c){"oscillator"!==
c&&a.setRealTimeAnalyser(c,b)});a.setAnalyser(b);X("audio").module("analyser").domain("time-all-L").drag(function(b){e(a,c,b)});X("audio").module("analyser").domain("time-all-R").drag(function(b){e(a,c,b)})};a.toggleAnalyserChannel=function(b,c){b.preventDefault();a.channel=c};a.selectAPI("canvas")}]);g.controller("MMLController",["$rootScope","$scope","$http","$timeout","BASE_URL","createDateTimeString",function(b,a,c,d,e,g){var f=[0,1,2,3];b={start:function(b,c){"oscillator"===a.$parent.currentSoundSource&&
X("mixer").mix([X("oscillator"),C("oscillator")]);if("R"!==b.indexes[c]){var e=b.indexes[c];d(function(){a.$parent.isSoundStops[e]=!1})}},stop:function(b,c){if("R"!==b.indexes[c]){var e=b.indexes[c];d(function(){a.isSoundStops[e]=!0})}},ended:function(){angular.forEach(f,function(a){X("oscillator",a).state(!1);C("oscillator",a).state(!1)});a.readyMML();a.paused=!0;a.$parent.clearKeyboards()},error:function(a,b){}};X("mml").setup(b);C("mml").setup(b);a.paused=!0;a.mml="";a.dataURL="";a.filename="";
a.error="";a.$watch(function(){return a.$parent.currentSoundSource},function(b){a.readyMML()});c.get(Math.floor(2*Math.random())?e+"mml/mml-foreverlove.txt":e+"mml/mml-tears.txt").success(function(b,c,d,e){a.mml=b;a.typeMML()}).error(function(a,b,c,d){});a.typeMML=function(b){a.readyMML();a.paused=!0};a.readyMML=function(){var b=a.mml.split(/\|+/);"oscillator"===a.$parent.currentSoundSource?(0<b.length&&(X("mml").ready(X("oscillator"),b[0]),C("mml").ready(C("oscillator"),[])),1<b.length&&C("mml").ready(C("oscillator"),
b[1])):X("mml").ready(X("oneshot"),b)};a.controlMML=function(b){b.preventDefault();X("mml").isSequences()&&(b=X("mml").get(),a.paused?("oscillator"===a.$parent.currentSoundSource?(angular.forEach(f,function(a){X("oscillator",a).state(!0);C("oscillator",a).state(!0)}),a.$parent.oscillators.oscillator0.isActive=!0,a.$parent.oscillators.oscillator1.isActive=!0,0<X("mml").get().length&&X("mml").start(0),0<C("mml").get().length&&C("mml").start(0),X("mixer").module("recorder").start(),X("mixer").module("session").start()):
(angular.forEach(b,function(a,b){X("mml").start(b)}),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),a.paused=!1):(X("mml").stop(),C("mml").stop(),angular.forEach(f,function(a){X("oscillator",a).state(!0);C("oscillator",a).state(!0)}),a.paused=!0))};a.stopMML=function(b){X("mml").stop();C("mml").stop();a.readyMML();a.paused=!0;a.$parent.clearKeyboards()};a.downloadMML=function(b){0===a.mml.trim().length?b.preventDefault():(a.dataURL=X("mml").download(a.mml),a.filename=
"mml-"+g()+".txt")}}]);g.controller("SessionController",["$scope","$location","$timeout","sources","openDialog",function(b,a,c,d,e){var g="",f="";-1!==a.host().indexOf("localhost")?(g="localhost",f=""):-1!==a.host().indexOf("korilakkuma.github.io")&&(g="210.152.156.200",f="/home/node/websocket/");var h=function(a,d){e("Confirmation",800,"auto",!1,"<p><b>Connection to ("+d.url+") succeeded.</b></p>");c(function(){b.isActive=!0})},n=function(a,d){e("Confirmation",400,"auto",!0,"<p><b>Connection closed.</b></p>");
c(function(){b.isActive=!1})},p=function(a,d){e("Error",400,"auto",!0,"<p><b>Server Error.</b></p>");c(function(){b.isActive=!1})},l=function(){c(function(){b.$parent.isModalProgressSessionWait=!1;X("mixer").module("session").state()?b.isActive=!0:b.isActive=!1})},m=function(a){b.$parent.isModalProgressSessionWait=!0};b.isActive=!1;b.url="";b.toggleSessionState=function(a){b.isActive=!b.isActive;if(b.isActive)if(X("mixer").module("session").isConnected()&&X("oneshot").module("session").isConnected()&&
X("audio").module("session").isConnected()&&X("stream").module("session").isConnected())angular.forEach(d,function(a){"oscillator"!==a&&X(a).module("session").state(!0,l,m)});else{var c={tls:!1,host:g,port:8E3,path:f,open:h,close:n,error:p};try{angular.forEach(d,function(a){"oscillator"!==a&&(X("mixer").module("session").setup(c).state(!0,l,m),c.port++)})}catch(t){b.isActive=!1,e("Error",400,"auto",!0,"<p><b>"+t.message+"</b></p>")}}else angular.forEach(d,function(a){"oscillator"!==a&&X(a).module("session").state(!1,
l,m)})}}])})();