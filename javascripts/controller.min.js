/** 
 * controller.min.js
 *
 * @fileoverview AngularJS controller for X Sound Application
 * 
 * JavaScript Libraries :
 *     XSound.js (https://github.com/Korilakkuma/XSound)
 *     jQuery / jQuery UI
 *     select2.js
 *
 * Copyright 2012, 2013, 2014@Tomohiro IKEDA
 * Released under the MIT license
 */
(function(){var h=angular.module("xsound",[]);h.config(["$compileProvider",function(b){b.aHrefSanitizationWhitelist(/^\s*(https?|data|blob):/)}]);h.factory("BASE_URL",["$location",function(b){var a="";return a="localhost"===b.host()?b.protocol()+"://"+b.host()+"/~rilakkuma3xjapan/GitHub/X-Sound/resources/":b.protocol()+"://"+b.host()+"/X-Sound/resources/"}]);h.value("sources",["mixer","oscillator","oneshot","audio","stream"]);h.value("updateParamEachOscillator",function(b,a,c,f){var e=[0,1,2,3];switch(b){case 0:a?
angular.forEach(e,function(b){X("oscillator",b).module(a).param(c,f)}):angular.forEach(e,function(a){X("oscillator",a).param(c,f)});break;case 1:a?angular.forEach(e,function(b){C("oscillator",b).module(a).param(c,f)}):angular.forEach(e,function(a){C("oscillator",a).param(c,f)})}});h.value("updateParamOfModule",function(b,a,c,f){"oscillator"===b&&"eg"===a?(X("oscillator").module("eg").param(c,f),C("oscillator").module("eg").param(c,f)):"analyser"===a&&"interval"===c?0<f?(X(b).module("analyser").domain("time").param("interval",
f),X(b).module("analyser").domain("fft").param("interval",f)):(X(b).module("analyser").domain("time").param("interval","auto"),X(b).module("analyser").domain("fft").param("interval","auto")):(X(b).module(a).param(c,f),"oscillator"===b&&C("oscillator").module(a).param(c,f))});h.value("updateParamOfSource",function(b,a,c){"oneshot"===b&&"playbackRate"===a?X("oneshot").param("transpose",c):(X(b).param(a,c),C("oscillator").param(a,c))});h.factory("updateParam",["updateParamEachOscillator","updateParamOfModule",
"updateParamOfSource",function(b,a,c){return function(f,e,k,l){var g=[],g=f?f.split(" "):["mixer","oscillator","oneshot","audio","stream"];angular.forEach(g,function(g){var f=g.match(/oscillator(0|1)/);null!==f?b(parseInt(f[1]),e,k,l):e?a(g,e,k,l):c(g,k,l)})}}]);h.value("openDialog",function(b,a,c,f,e){$("<div />").html(e).dialog({title:b,autoOpen:!0,show:"explode",hide:"explode",width:a,height:c,modal:f,draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){$(this).dialog("close").dialog("destroy").remove()}}})});
h.factory("readFile",["openDialog",function(b){return function(a){try{var c=X.file(a)}catch(f){b("Error",500,"auto",!0,"<p><b>"+f.message+"</b></p>")}return c}}]);h.factory("readFileByDragAndDrop",["readFile",function(b){return function(a,c){a.addEventListener("dragenter",function(a){a.preventDefault();$(this).removeClass("drag-off").addClass("drag-on")});a.addEventListener("dragover",function(a){a.preventDefault()});a.addEventListener("dragleave",function(a){$(this).removeClass("drag-on").addClass("drag-off")});
a.addEventListener("drop",function(a){$(this).removeClass("drag-on").addClass("drag-off");c.event=a;a=b(c);a instanceof Blob&&(this.value=a.name)})}}]);h.factory("readFileErrorCallback",["openDialog",function(b){return function(a){var c="";switch(a){case "FILE_IS_NOT_BLOB":c="The designated file is not Blob";break;case "NOT_FOUND_ERR":c="There is not file";break;case "SECURITY_ERR":c="Security error occurred";break;case "ABORT_ERR":c="Abort";break;case "NOT_READABLE_ERR":c="The authority to read file does not exists";
break;case "ENCODING_ERR":c="FIle size exceeds limit";break;case "ERR":c="Error. Please try again."}b("Error",500,"auto",!0,"<p><b>"+c+"</b></p>")}}]);h.value("readFileProgressCallback",function(b,a,c){var f=0,e="";c.lengthComputable&&0<c.total&&(f=Math.floor(c.loaded/c.total*100),e=c.loaded+" Bytes load ("+f+" %)",a(function(){b.readFileProgress=e;b.isModalProgressReadFile||(b.isModalProgressReadFile=!0)}))});h.factory("drawNodeCallback",["$rootScope",function(b){return function(a,c){0<=c&&c<=X("audio").param("duration")&&
(X("audio").param("currentTime",c),X("audio").module("analyser").domain("time-all-L").update(c),X("audio").module("analyser").domain("time-all-R").update(c),a(function(){b.currentTime=c}))}}]);h.value("createTimeString",function(b){b=X.convertTime(b);return 0===b.milliseconds?("0"+b.minutes).slice(-2)+" : "+("0"+b.seconds).slice(-2)+".00":("0"+b.minutes).slice(-2)+" : "+("0"+b.seconds).slice(-2)+"."+String(b.milliseconds).slice(2,4)});h.value("createDateTimeString",function(){var b=function(a){return("0"+
a).slice(-2)},a=new Date,c=a.getFullYear(),f=b(a.getMonth()+1),e=b(a.getDate()),k=b(a.getHours()),l=b(a.getMinutes()),b=b(a.getSeconds());return c+f+e+k+l+b});h.value("getCurrentPatches",function(){return{mastervolume:X("oscillator").params().mastervolume,glide:{type:X("oscillator").params().oscillator.glide.type,time:X("oscillator").params().oscillator.glide.time},oscillator0:X("oscillator").params().oscillator.oscillator0,oscillator1:C("oscillator").params().oscillator.oscillator0,eg:{attack:X("oscillator").params().eg.attack,
decay:X("oscillator").params().eg.decay,sustain:X("oscillator").params().eg.sustain,release:X("oscillator").params().eg.release},compressor:{state:X("oscillator").params().compressor.state,threshold:X("oscillator").params().compressor.threshold,knee:X("oscillator").params().compressor.knee,ratio:X("oscillator").params().compressor.ratio,attack:X("oscillator").params().compressor.attack,release:X("oscillator").params().compressor.release},distortion:{state:X("oscillator").params().distortion.state,
curve:X("oscillator").params().distortion.curve,samples:X("oscillator").params().distortion.samples,drive:X("oscillator").params().distortion.drive,color:X("oscillator").params().distortion.color,tone:X("oscillator").params().distortion.tone},wah:{state:X("oscillator").params().wah.state,cutoff:X("oscillator").params().wah.cutoff,depth:X("oscillator").params().wah.depth,rate:X("oscillator").params().wah.rate,resonance:X("oscillator").params().wah.resonance},equalizer:{state:X("oscillator").params().equalizer.state,
bass:X("oscillator").params().equalizer.bass,middle:X("oscillator").params().equalizer.middle,treble:X("oscillator").params().equalizer.treble,presence:X("oscillator").params().equalizer.presence},filter:{state:X("oscillator").params().filter.state,type:X("oscillator").params().filter.type,frequency:X("oscillator").params().filter.frequency,Q:X("oscillator").params().filter.Q,gain:X("oscillator").params().filter.gain,attack:X("oscillator").params().filter.attack,decay:X("oscillator").params().filter.decay,
sustain:X("oscillator").params().filter.sustain,release:X("oscillator").params().filter.release},autopanner:{state:X("oscillator").params().autopanner.state,depth:X("oscillator").params().autopanner.depth,rate:X("oscillator").params().autopanner.rate},tremolo:{state:X("oscillator").params().tremolo.state,depth:X("oscillator").params().tremolo.depth,rate:X("oscillator").params().tremolo.rate},ringmodulator:{state:X("oscillator").params().ringmodulator.state,depth:X("oscillator").params().ringmodulator.depth,
rate:X("oscillator").params().ringmodulator.rate},phaser:{state:X("oscillator").params().phaser.state,stage:X("oscillator").params().phaser.stage,frequency:X("oscillator").params().phaser.frequency,depth:X("oscillator").params().phaser.depth,rate:X("oscillator").params().phaser.rate,mix:X("oscillator").params().phaser.mix,feedback:X("oscillator").params().phaser.feedback},chorus:{state:X("oscillator").params().chorus.state,time:1E3*X("oscillator").params().chorus.time,depth:X("oscillator").params().chorus.depth,
rate:X("oscillator").params().chorus.rate,mix:X("oscillator").params().chorus.mix,tone:X("oscillator").params().chorus.tone},flanger:{state:X("oscillator").params().flanger.state,time:1E3*X("oscillator").params().flanger.time,depth:X("oscillator").params().flanger.depth,rate:X("oscillator").params().flanger.rate,mix:X("oscillator").params().flanger.mix,tone:X("oscillator").params().flanger.tone,feedback:X("oscillator").params().flanger.feedback},delay:{state:X("oscillator").params().delay.state,time:1E3*
X("oscillator").params().delay.time,dry:X("oscillator").params().delay.dry,wet:X("oscillator").params().delay.wet,tone:X("oscillator").params().delay.tone,feedback:X("oscillator").params().delay.feedback},reverb:{state:X("oscillator").params().reverb.state,dry:X("oscillator").params().reverb.dry,wet:X("oscillator").params().reverb.wet,tone:X("oscillator").params().reverb.tone}}});h.run(["$rootScope","$window","sources","openDialog",function(b,a,c,f){X.IS_XSOUND?(b.isActives={visualization:!1,mml:!1,
patch:!1},b.currentTime=0,a.C=X.clone(),X.free([X("media"),X("fallback"),C("oneshot"),C("audio"),C("media"),C("fallback"),C("stream"),C("mixer")]),X("mixer").resize(4096),X("oscillator").resize(4096),C("oscillator").resize(4096),X("oneshot").resize(4096),X("audio").resize(8192),X("stream").resize(512),X("oscillator").setup([!0,!1,!1,!1]),C("oscillator").setup([!1,!1,!1,!1]),X("stream").setup(!1,function(a){console.dir(a)},function(a){f("Confirmation",400,"auto",!0,"<p><b>Cancel Microphone.</b></p>");
console.dir(a)}),angular.forEach(c,function(a){X(a).module("distortion").param("color",2E3);X(a).module("distortion").param("tone",4E3);X(a).module("chorus").param("tone",4E3);X(a).module("flanger").param("tone",4E3);X(a).module("delay").param("tone",4E3);X(a).module("reverb").param("tone",4E3);X(a).module("filter").param("frequency",8E3)}),C("oscillator").module("distortion").param("color",2E3),C("oscillator").module("distortion").param("tone",4E3),C("oscillator").module("chorus").param("tone",4E3),
C("oscillator").module("flanger").param("tone",4E3),C("oscillator").module("delay").param("tone",4E3),C("oscillator").module("reverb").param("tone",4E3),C("oscillator").module("filter").param("frequency",8E3)):f("Error",600,"auto",!0,"<p><b>Your Browser does not support Web Audio API. Please use Chrome, Opera, Firefox (Mac / Windows) or Safari (Mac).</b></p>")}]);h.directive("uiSlider",["updateParam",function(b){return{restrict:"EA",template:"<div></div>",link:function(a,c,f,e,k){a=f.value;e=f.min;
k=f.max;var l=f.step,g=f.range||"min",n=f.animate||"slow",h=f.source,m=f.module,p=f.param,r=m?m+"-"+p:p,u=function(a){b(h,m,p,a);$(".spinner-"+r).each(function(b,g){var c=$(g).parents("ui-spinner");c.attr("source")===h&&c.attr("module")===m&&("glide"!==m&&"time"===p&&(a*=Math.pow(10,3)),$(g).spinner("value",a))})};$(c).children("div").addClass("slider-"+r).slider({value:parseFloat(a),min:parseFloat(e),max:parseFloat(k),step:parseFloat(l),range:g,animate:n,change:function(a,b){var g=parseFloat(b.value);
"glide"!==m&&"time"===p&&(g/=Math.pow(10,3));u(g)},slide:function(a,b){var g=parseFloat(b.value);"glide"!==m&&"time"===p&&(g/=Math.pow(10,3));u(g)}})}}}]);h.directive("uiSpinner",["updateParam",function(b){return{restrict:"EA",template:"<input />",link:function(a,c,f,e,k){a=f.value;e=f.min;k=f.max;var l=f.step,g=f.source,n=f.module,h=f.param,m=n?n+"-"+h:h,p=function(a){b(g,n,h,a);$(".slider-"+m).each(function(b,c){var e=$(c).parent("ui-slider");e.attr("source")===g&&e.attr("module")===n&&("glide"!==
n&&"time"===h&&(a*=Math.pow(10,3)),$(c).slider("value",a))})};$(c).children("input").addClass("spinner-"+m).spinner({min:parseFloat(e),max:parseFloat(k),step:parseFloat(l),spin:function(a,b){var g=parseFloat(b.value);"glide"!==n&&"time"===h&&(g/=Math.pow(10,3));p(g)}}).spinner("value",parseFloat(a))}}}]);h.directive("uiSliderTime",["$rootScope","$timeout","createTimeString",function(b,a,c){return{restrict:"EA",template:"<div></div>",link:function(f,e,k,l,g){l=k.value;g=k.max;var n=k.step,h=k.range||
"min";k=k.animate||"slow";$(e).children("div").attr("id","slider-audio-current-time").slider({value:parseFloat(l),min:0,max:parseFloat(g),step:parseFloat(n),range:h,animate:k,change:function(a,b){},slide:function(g,c){X("audio").param("currentTime",parseFloat(c.value));X("audio").module("analyser").domain("time-all-L").update(X("audio").param("currentTime"));X("audio").module("analyser").domain("time-all-R").update(X("audio").param("currentTime"));a(function(){b.currentTime=X("audio").param("currentTime")})}});
f.$watch(function(){return f.duration},function(a){$("#slider-audio-current-time").slider("option","max",a);$("#spinner-audio-current-time").spinner("option","max",a)});f.$watch(function(){return b.currentTime},function(a){$("#slider-audio-current-time").slider("value",a);$("#spinner-audio-current-time").spinner("value",a);f.currentTimeText=c(a)})}}}]);h.directive("uiSpinnerTime",["$rootScope","$timeout",function(b,a){return{restrict:"EA",template:"<input />",link:function(c,f,e,k,l){c=e.value;k=
e.max;e=e.step;$(f).children("input").attr("id","spinner-audio-current-time").spinner({min:0,max:parseFloat(k),step:parseFloat(e),spin:function(g,c){X("audio").param("currentTime",parseFloat(c.value));X("audio").module("analyser").domain("time-all-L").update(X("audio").param("currentTime"));X("audio").module("analyser").domain("time-all-R").update(X("audio").param("currentTime"));a(function(){b.currentTime=X("audio").param("currentTime")})}}).spinner("value",parseFloat(c))}}}]);h.directive("uiToggleEffector",
["sources",function(b){return{restrict:"A",link:function(a,c,f,e,k){var l=f.effector,g=parseInt(f.state);0!==g&&1!==g||angular.forEach(b,function(a){X(a).module(l).state(Boolean(g));C("oscillator").module(l).state(Boolean(g));X(a).module(l).state()?$(c).addClass("check-on"):$(c).removeClass("check-on")});$(c).on("click",function(){angular.forEach(b,function(a){X(a).module(l).state()?(X(a).module(l).state(!1),C("oscillator").module(l).state(!1),$(c).removeClass("check-on")):(X(a).module(l).state(!0),
C("oscillator").module(l).state(!0),$(c).addClass("check-on"))})})}}}]);h.directive("uiModalProgress",[function(){return{restrict:"EA",link:function(b,a,c,f,e){$(a).css({position:"fixed",top:"0px",left:"0px","z-index":999,padding:"15% 0%",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.6)"})}}}]);h.directive("uiTooltip",function(){return{restrict:"A",link:function(b,a,c,f,e){$(a).tooltip({tooltipClass:"ui-tooltip-custom"})}}});h.directive("uiSortable",function(){return{restrict:"A",
link:function(b,a,c,f,e){$(a).sortable({axis:"x",cancel:"fieldset, :input, button, label, a, #piano",cursor:"move",opacity:.6})}}});h.directive("uiSelect",["$timeout","sources",function(b,a){return{restrict:"A",link:function(c,f,e,k,l){$(f).select2();switch($(f).attr("id")){case "select-sound-source":$(f).on("change",function(){var a=this.value;switch(a){case "oscillator":X("stream").stop();b(function(){c.currentSoundSource=a;c.selectedSoundSource=a});break;case "one-shot":c.isEnableOneshot&&b(function(){c.currentSoundSource=
a;c.selectedSoundSource=a});X("stream").stop();break;case "stream":try{X("stream").start(),X("stream").module("session").start(),b(function(){c.selectedSoundSource=a})}catch(e){openDialog("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}break;case "midi":X("stream").stop()}});break;case "select-rec-track":$(f).on("change",function(){if(!c.isActive){var g=parseInt(this.value);b(function(){c.activeTrack=g});angular.forEach(a,function(a){"oscillator"!==a&&"audio"!==a&&(X(a).module("recorder").ready(g),
"stream"===a&&X("stream").module("recorder").start())})}});break;case "select-visualization-api":$(f).on("change",function(){c.selectAPI(this.value)});break;case "select-distortion-type":$(f).on("change",function(){var b=this.value;angular.forEach(a,function(a){X(a).module("distortion").param("curve",b)})});break;case "select-distortion-sample":$(f).on("change",function(){var b=this.value;angular.forEach(a,function(a){X(a).module("distortion").param("samples",b)})});break;case "select-filter-type":$(f).on("change",
function(){var b=this.value;angular.forEach(a,function(a){X(a).module("filter").param("type",b)})});break;case "select-phaser-stage":$(f).on("change",function(){var b=this.value;angular.forEach(a,function(a){X(a).module("phaser").param("stage",b)})});case "select-reverb-type":$(f).on("change",function(){var b=parseInt(this.value)-1;-1===b&&(b=null);angular.forEach(a,function(a){X(a).module("reverb").param("type",b)})})}}}}]);h.directive("slideBlock",["$rootScope",function(b){return{restrict:"A",link:function(a,
c,f,e,k){var l=f.model;$(c).hide();a.$watch(function(){return b.isActives},function(a){a[l]?$(c).slideDown(1E3,"easeOutQuint"):$(c).slideUp(1E3,"easeOutQuint")},!0)}}}]);h.directive("audioUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(b,a,c,f,e){return{restrict:"A",link:function(k,l,g,h,q){var m={event:null,type:"ArrayBuffer",success:function(a,c){X("audio").ready.call(X("audio"),c);b(function(){k.isModalProgressReadFile=!1})},
error:function(a,b){e(b)},progress:function(a){f(k,b,a)}};l[0].addEventListener("change",function(b){m.event=b;b=a(m);this.value="";b instanceof Blob&&$(l).next('[type="text"]').val(b.name)},!1);g=$(l).next('[type="text"]')[0];c(g,m)}}}]);h.directive("rirUploader",["$timeout","sources","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(b,a,c,f,e,k){return{restrict:"A",link:function(l,g,h,q,m){var p={event:null,type:"ArrayBuffer",success:function(c,g){angular.forEach(a,
function(a){X(a).module("reverb").start.call(X(a).module("reverb"),g)});b(function(){l.isModalProgressReadFile=!1})},error:function(a,b){k(b)},progress:function(a){e(l,b,a)}};g[0].addEventListener("change",function(a){p.event=a;a=c(p);this.value="";a instanceof Blob&&$(g).next('[type="text"]').val(a.name)},!1);h=$(g).next('[type="text"]')[0];f(h,p)}}}]);h.directive("mmlUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(b,a,c,f,e){return{restrict:"A",
link:function(k,l,g,h,q){var m={event:null,type:"Text",success:function(a,c){var g=function(){b(function(){k.mml=c;k.paused=!0;k.readyMML()})};""===k.mml?g():$("<div />").html("<p><b>MML already exists. Overwrite ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:500,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){g();$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}});
b(function(){k.isModalProgressReadFile=!1})},error:function(a,b){e(b)},progress:function(a){f(k,b,a)}};l[0].addEventListener("change",function(b){m.event=b;b=a(m);this.value="";b instanceof Blob&&$(l).next('[type="text"]').val(b.name)},!1);g=$(l).next('[type="text"]')[0];c(g,m)}}}]);h.controller("XSoundController",["$rootScope","$scope","$window","$timeout","BASE_URL","sources","openDialog","getCurrentPatches",function(b,a,c,f,e,k,l,g){g=[e+"one-shot/piano-2/C.wav",e+"one-shot/piano-2/D.wav",e+"one-shot/piano-2/E.wav",
e+"one-shot/piano-2/F.wav",e+"one-shot/piano-2/G.wav",e+"one-shot/piano-2/A.wav",e+"one-shot/piano-2/B.wav"];var h=function(a){switch(parseInt((a+9)%12)){case 0:case 1:return 0;case 2:case 3:return 1;case 4:return 2;case 5:case 6:return 3;case 7:case 8:return 4;case 9:case 10:return 5;case 11:return 6}},q=function(){for(var a=Array(88),b=0;88>b;b++){var c={buffer:0,rate:1,loop:!1,start:0,end:0,volume:1};c.buffer=h(b);var g=c,e=b,f=-1!==[1,4,6,9,11,13,16,18,21,23,25,28,30,33,35,37,40,42,45,47,49,52,
54,57,59,61,64,66,69,71,73,76,78,81,83,85].indexOf(e)?!0:!1,d=0;0<=e&&2>=e?d=.0625:3<=e&&14>=e?d=.125:15<=e&&26>=e?d=.25:27<=e&&38>=e?d=.5:39<=e&&50>=e?d=1:51<=e&&62>=e?d=2:63<=e&&74>=e?d=4:75<=e&&86>=e?d=8:87<=e&&98>=e&&(d=16);f&&(d*=Math.pow(2,1/12));g.rate=d;a[b]=c}return a},m=function(){f(function(){a.isReady=!0})},p=function(){var b=[];angular.forEach(a.rirs,function(c,e){X.ajax(c.url,6E4,function(c,e){X.decode(X.get(),e,function(c){b.push(c);a.$apply(function(){a.progress=Math.floor(b.length/
a.rirs.length*100);a.progressStyle.width=a.progress+"%"});b.length===a.rirs.length&&(angular.forEach(k,function(a){X(a).module("reverb").preset(b)}),C("oscillator").module("reverb").preset(b),m())},function(){m()})},function(a,b){l("Error",400,"auto",!0,"<p><b>The loading of RIRs failed.</b></p>")})})};try{X("oneshot").setup({resources:g,settings:q(),timeout:6E4,success:function(b,c){a.isEnableOneshot=!0;0===a.rirs.length?m():p()},error:function(a,b){l("Error",400,"height",!0,"<p><b>The loading of audio files failed.</b></p>")},
progress:function(a){}})}catch(r){l("Error",400,"height",!0,"<p><b>"+r.message+"</b></p>")}a.currentSoundSource="oscillator";a.selectedSoundSource="oscillator";a.isReady=!1;a.progress=0;a.progressStyle={width:a.progress+"%"};a.isSafari=function(){var a=navigator.userAgent.toLowerCase();return-1===a.indexOf("chrome")&&-1!==a.indexOf("safari")?!0:!1}();a.isEnableOneshot=!1;a.isEndOpeing=!1;a.isStart=!1;a.headerStyle={top:parseInt(c.innerHeight/4)+"px"};a.isModalProgressDecodeAudio=!1;a.isModalProgressReadFile=
!1;a.isModalProgressSessionWait=!1;a.oscillators={};a.oscillators.oscillator0={};a.oscillators.oscillator0.isActive=!0;a.oscillators.oscillator0.type="sine";a.oscillators.oscillator1={};a.oscillators.oscillator1.isActive=!1;a.oscillators.oscillator1.type="sine";a.readFileProgress="";c=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")?[]:[{url:e+"impulse-responses/s1_r1_c.wav",value:1,label:"1 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r2_c.wav",
value:2,label:"1 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r3_c.wav",value:3,label:"1 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r4_c.wav",value:4,label:"1 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r1_c.wav",value:5,label:"2 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r2_c.wav",
value:6,label:"2 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r3_c.wav",value:7,label:"2 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s2_r4_c.wav",value:8,label:"2 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r1_c.wav",value:9,label:"3 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r2_c.wav",
value:10,label:"3 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r3_c.wav",value:11,label:"3 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s3_r4_c.wav",value:12,label:"3 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:e+"impulse-responses/s1_r1_o.wav",value:13,label:"1 - 1",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_r2_o.wav",
value:14,label:"1 - 2",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_r3_o.wav",value:15,label:"1 - 3",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_r4_o.wav",value:16,label:"1 - 4",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r1_o.wav",value:17,label:"2 - 1",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r2_o.wav",value:18,label:"2 - 2",
group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r3_o.wav",value:19,label:"2 - 3",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s2_r4_o.wav",value:20,label:"2 - 4",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s3_r1_o.wav",value:21,label:"3 - 1",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s3_r2_o.wav",value:22,label:"3 - 2",group:"Omnidirectional measurements in the audience area"},
{url:e+"impulse-responses/s3_r3_o.wav",value:23,label:"3 - 3",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s3_r4_o.wav",value:24,label:"3 - 4",group:"Omnidirectional measurements in the audience area"},{url:e+"impulse-responses/s1_p1_o.wav",value:25,label:"1 - 1",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s1_p2_o.wav",value:26,label:"1 - 2",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s1_p3_o.wav",
value:27,label:"1 - 3",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s2_p1_o.wav",value:28,label:"2 - 1",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s2_p2_o.wav",value:29,label:"2 - 2",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s2_p3_o.wav",value:30,label:"2 - 3",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s3_p1_o.wav",value:31,label:"3 - 1",group:"Omnidirectional measurements on the stage"},
{url:e+"impulse-responses/s3_p2_o.wav",value:32,label:"3 - 2",group:"Omnidirectional measurements on the stage"},{url:e+"impulse-responses/s3_p3_o.wav",value:33,label:"3 - 3",group:"Omnidirectional measurements on the stage"}];a.rirs=c;a.pianoKeyboards={};a.pianoKeyboards.keyboards={"A-4":0,"A-4h":1,"B-4":2,"C-3":3,"C-3h":4,"D-3":5,"D-3h":6,"E-3":7,"F-3":8,"F-3h":9,"G-3":10,"G-3h":11,"A-3":12,"A-3h":13,"B-3":14,"C-2":15,"C-2h":16,"D-2":17,"D-2h":18,"E-2":19,"F-2":20,"F-2h":21,"G-2":22,"G-2h":23,"A-2":24,
"A-2h":25,"B-2":26,"C-1":27,"C-1h":28,"D-1":29,"D-1h":30,"E-1":31,"F-1":32,"F-1h":33,"G-1":34,"G-1h":35,"A-1":36,"A-1h":37,"B-1":38,C:39,Ch:40,D:41,Dh:42,E:43,F:44,Fh:45,G:46,Gh:47,A:48,Ah:49,B:50,C1:51,C1h:52,D1:53,D1h:54,E1:55,F1:56,F1h:57,G1:58,G1h:59,A1:60,A1h:61,B1:62,C2:63,C2h:64,D2:65,D2h:66,E2:67,F2:68,F2h:69,G2:70,G2h:71,A2:72,A2h:73,B2:74,C3:75,C3h:76,D3:77,D3h:78,E3:79,F3:80,F3h:81,G3:82,G3h:83,A3:84,A3h:85,B3:86,C4:87};a.pianoKeyboards.whites="A-4 B-4 C-3 D-3 E-3 F-3 G-3 A-3 B-3 C-2 D-2 E-2 F-2 G-2 A-2 B-2 C-1 D-1 E-1 F-1 G-1 A-1 B-1 C D E F G A B C1 D1 E1 F1 G1 A1 B1 C2 D2 E2 F2 G2 A2 B2 C3 D3 E3 F3 G3 A3 B3 C4".split(" ");
a.pianoKeyboards.blacks="A-4h skip C-3h D-3h skip F-3h G-3h A-3h skip C-2h D-2h skip F-2h G-2h A-2h skip C-1h D-1h skip F-1h G-1h A-1h skip Ch Dh skip Fh Gh Ah skip C1h D1h skip F1h G1h A1h skip C2h D2h skip F2h G2h A2h skip C3h D3h skip F3h G3h A3h".split(" ");a.isSoundStops=[];angular.forEach(a.pianoKeyboards.keyboards,function(){a.isSoundStops.push(!0)});a.startApplication=function(b){b.preventDefault();a.isStart=!0;f(function(){a.isEndOpening=!0},2E3)};a.startSound=function(b,c){X.IS_XSOUND&&
!$(b.currentTarget).hasClass("skip")&&("oscillator"===a.currentSoundSource?(X("oscillator").ready(0,0).start(X.toFrequencies(c)),C("oscillator").ready(0,0).start(X.toFrequencies(c)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()):(X("oneshot").ready(0,0).start(c),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),a.isSoundStops[c]=!1)};a.stopSound=function(b,c){X.IS_XSOUND&&!$(b.currentTarget).hasClass("skip")&&
(b.stopPropagation(),"oscillator"===a.currentSoundSource?(X("oscillator").stop(),C("oscillator").stop()):X("oneshot").stop(c),a.isSoundStops[c]=!0)};a.clearKeyboards=function(){angular.forEach(a.isSoundStops,function(b,c){a.isSoundStops[c]=!0})};a.toggleOscillatorState=function(b,c){var e=!a.oscillators["oscillator"+c].isActive;switch(c){case 0:X("oscillator",0).state(e);break;case 1:C("oscillator",0).state(e)}a.oscillators["oscillator"+c].isActive=e};a.toggleAnalyserState=function(c){b.isActives.visualization=
!a.isActives.visualization;angular.forEach(k,function(a){"oscillator"!==a&&(X(a).module("analyser").domain("time").state(b.isActives.visualization),X(a).module("analyser").domain("fft").state(b.isActives.visualization))})};a.toggleMMLState=function(a){b.isActives.mml=!b.isActives.mml};a.togglePatchState=function(c){b.isActives.patch=!b.isActives.patch;b.isActives.patch&&$("#patch-container").colorbox({open:!0,inline:!0,href:"#patch-container",width:"600px",height:"480px",transition:"fade",speed:600,
opacity:.6,fadeOut:600,returnFocus:!1,onOpen:function(){a.$broadcast("onOpenPatchDialog")},onCleanup:function(){f(function(){b.isActives.patch=!1})}})};a.changeWaveType=function(b,c,e){switch(c){case 0:X("oscillator",0).param("type",e);break;case 1:C("oscillator",0).param("type",e)}a.oscillators["oscillator"+c].type=e};a.triggerFileUploader=function(a){$(a.currentTarget).prev('[type="file"]').trigger("click")}}]);h.controller("AudioController",["$rootScope","$scope","$timeout","createTimeString",
function(b,a,c,f){X("audio").setup({decode:function(b){c(function(){a.$parent.isModalProgressDecodeAudio=!0})},ready:function(b){var k=b.duration;c(function(){a.$parent.isModalProgressDecodeAudio=!1;a.isActive=!1;a.duration=k;a.durationText=f(k);a.currentTimeText="00 : 00.00"})},start:function(b,f){X("audio").module("session").start();c(function(){a.isActive=!0})},stop:function(b,f){c(function(){a.isActive=!1})},update:function(e,k){c(function(){b.currentTime=k;a.currentTimeText=f(k)})},ended:function(e,
f){X("audio").module("analyser").domain("time-all-L").update(0);X("audio").module("analyser").domain("time-all-R").update(0);c(function(){a.isActive=!1;b.currentTime=0;a.currentTimeText="00 : 00.00"})}});a.currentTime=0;a.currentTimeText="00 : 00.00";a.duration=0;a.durationText="00 : 00.00";a.isActive=!1;a.controlAudio=function(a){X("audio").toggle(X("audio").param("currentTime"))}}]);h.controller("RecordController",["$scope","$timeout","sources","openDialog","createDateTimeString",function(b,a,c,
f,e){var k=function(){$("<div />").html("<p><b>Start recording in the TRACK "+(b.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{START:function(){angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&(X(a).module("recorder").ready(b.activeTrack),"stream"===a&&X("stream").module("recorder").start())});a(function(){b.isActive=!0});$(this).dialog("close").dialog("destroy").remove()},
CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},l=function(){$("<div />").html("<p><b>Stop the recording. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{STOP:function(){angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").stop()});a(function(){b.isActive=!1});$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})};
b.isActive=!1;b.tracks=[1,2,3,4];b.activeTrack=0;b.objectURL="";b.finename="";angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").setup(b.tracks.length)});b.controlRecord=function(a){a.preventDefault();b.isActive?l():k()};b.createWAVE=function(a){a.preventDefault();b.isActive||(a=b.$parent.selectedSoundSource,"oscillator"===a&&(a="mixer"),b.objectURL=X(a).module("recorder").create("all",16,2,"blob"),b.objectURL&&(a=new Audio(b.objectURL),a.setAttribute("controls",
!1),a.play()))};b.downloadWAVE=function(a){b.isActive?a.preventDefault():b.objectURL?b.filename="recorded-"+e()+".wav":(a.preventDefault(),f("Error",450,"auto",!0,"<p><b>The recorded sound data does not exists.</b></p>"))};b.clearTrack=function(a){a.preventDefault();b.isActive||$("<div />").html("<p><b>Clear the TRACK "+(b.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,
buttons:{CLEAR:function(){angular.forEach(c,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").clear(b.activeTrack)});$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})}}]);h.controller("VisualizationController",["$rootScope","$scope","$timeout","sources","drawNodeCallback",function(b,a,c,f,e){a.api="canvas";a.channel="left";a.setRealTimeAnalyser=function(a,b){X(a).module("analyser").param({fftSize:2048,minDecibels:-100,
maxDecibels:-30,smoothingTimeConstant:.1});X(a).module("analyser").domain("time").setup(b,b+"-time","svg-parent-time").param({interval:500,shape:"line",wave:"rgba(0, 0, 255, 1.0)",font:"12px Times New Roman",width:2,right:0});X(a).module("analyser").domain("fft").setup(b,b+"-spectrum","svg-parent-spectrum").param({interval:500,shape:"rect",wave:"canvas"===b?"gradient":"rgba(0, 0, 255, 1.0)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],font:"12px Times New Roman",
width:2,right:0,type:"uint",size:256})};a.setAnalyser=function(a){X("audio").module("analyser").domain("time-all-L").setup(a,a+"-time-all-L","svg-parent-L").state(!0).param({shape:"canvas"===a?"rect":"line",wave:"canvas"===a?"gradient":"rgba(0, 0, 255, 1.0)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],font:"12px Times New Roman",width:.5,right:0});X("audio").module("analyser").domain("time-all-R").setup(a,a+"-time-all-R","svg-parent-R").state(!0).param({shape:"canvas"===
a?"rect":"line",wave:"canvas"===a?"gradient":"rgba(0, 0, 255, 1.0)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],font:"12px Times New Roman",width:.5,right:0})};a.selectAPI=function(b){a.api=b;angular.forEach(f,function(c){"oscillator"!==c&&a.setRealTimeAnalyser(c,b)});a.setAnalyser(b);X("audio").module("analyser").domain("time-all-L").drag(function(a){e(c,a)});X("audio").module("analyser").domain("time-all-R").drag(function(a){e(c,a)})};a.toggleAnalyserChannel=
function(b,c){b.preventDefault();a.channel=c};a.selectAPI("canvas")}]);h.controller("MMLController",["$rootScope","$scope","$http","$timeout","BASE_URL","createDateTimeString",function(b,a,c,f,e,k){var h=[0,1,2,3];b={start:function(b,c){"oscillator"===a.$parent.currentSoundSource&&X("mixer").mix([X("oscillator"),C("oscillator")]);if("R"!==b.indexes[c]){var e=b.indexes[c];f(function(){a.$parent.isSoundStops[e]=!1})}},stop:function(b,c){if("R"!==b.indexes[c]){var e=b.indexes[c];f(function(){a.isSoundStops[e]=
!0})}},ended:function(){angular.forEach(h,function(a){X("oscillator",a).state(!1);C("oscillator",a).state(!1)});a.readyMML();a.paused=!0;a.$parent.clearKeyboards()},error:function(a,b){}};X("mml").setup(b);C("mml").setup(b);a.paused=!0;a.mml="";a.dataURL="";a.filename="";a.error="";a.$watch(function(){return a.$parent.currentSoundSource},function(b){a.readyMML()});c.get(Math.floor(2*Math.random())?e+"mml/mml-foreverlove.txt":e+"mml/mml-tears.txt").success(function(b,c,e,f){a.mml=b;a.typeMML()}).error(function(a,
b,c,e){});a.typeMML=function(b){a.readyMML();a.paused=!0};a.readyMML=function(){var b=a.mml.split(/\|+/);"oscillator"===a.$parent.currentSoundSource?(0<b.length&&(X("mml").ready(X("oscillator"),b[0]),C("mml").ready(C("oscillator"),[])),1<b.length&&C("mml").ready(C("oscillator"),b[1])):X("mml").ready(X("oneshot"),b)};a.controlMML=function(b){b.preventDefault();X("mml").isSequences()&&(b=X("mml").get(),a.paused?("oscillator"===a.$parent.currentSoundSource?(angular.forEach(h,function(a){X("oscillator",
a).state(!0);C("oscillator",a).state(!0)}),a.$parent.oscillators.oscillator0.isActive=!0,a.$parent.oscillators.oscillator1.isActive=!0,0<X("mml").get().length&&X("mml").start(0),0<C("mml").get().length&&C("mml").start(0),X("mixer").module("recorder").start(),X("mixer").module("session").start()):(angular.forEach(b,function(a,b){X("mml").start(b)}),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),a.paused=!1):(X("mml").stop(),C("mml").stop(),angular.forEach(h,function(a){X("oscillator",
a).state(!0);C("oscillator",a).state(!0)}),a.paused=!0))};a.stopMML=function(b){X("mml").stop();C("mml").stop();a.readyMML();a.paused=!0;a.$parent.clearKeyboards()};a.downloadMML=function(b){0===a.mml.trim().length?b.preventDefault():(a.dataURL=X("mml").create(a.mml),a.filename="mml-"+k()+".txt")}}]);h.controller("SessionController",["$scope","$location","$timeout","sources","openDialog",function(b,a,c,f,e){var k="",h="";-1!==a.host().indexOf("localhost")?(k="localhost",h=""):-1!==a.host().indexOf("korilakkuma.github.io")&&
(k="210.152.156.200",h="/home/node/websocket/");var g=function(a,f){e("Confirmation",800,"auto",!1,"<p><b>Connection to ("+f.url+") succeeded.</b></p>");c(function(){b.isActive=!0})},n=function(a,f){e("Confirmation",400,"auto",!0,"<p><b>Connection closed.</b></p>");c(function(){b.isActive=!1})},q=function(a,f){e("Error",400,"auto",!0,"<p><b>Server Error.</b></p>");c(function(){b.isActive=!1})},m=function(){c(function(){b.$parent.isModalProgressSessionWait=!1;X("mixer").module("session").state()?b.isActive=
!0:b.isActive=!1})},p=function(a){b.$parent.isModalProgressSessionWait=!0};b.isActive=!1;b.url="";b.toggleSessionState=function(a){b.isActive=!b.isActive;if(b.isActive)if(X("mixer").module("session").isConnected()&&X("oneshot").module("session").isConnected()&&X("audio").module("session").isConnected()&&X("stream").module("session").isConnected())angular.forEach(f,function(a){"oscillator"!==a&&X(a).module("session").state(!0,m,p)});else{var c={tls:!1,host:k,port:8E3,path:h,open:g,close:n,error:q};
try{angular.forEach(f,function(a){"oscillator"!==a&&(X(a).module("session").setup(c).state(!0,m,p),c.port++)})}catch(v){b.isActive=!1,e("Error",400,"auto",!0,"<p><b>"+v.message+"</b></p>")}}else angular.forEach(f,function(a){"oscillator"!==a&&X(a).module("session").state(!1,m,p)})}}]);h.controller("PatchController",["$rootScope","$scope","$http","$window","$location","$timeout","sources","openDialog","getCurrentPatches",function(b,a,c,f,e,h,l,g,n){var q;q=-1!==e.host().indexOf("localhost")?"http://localhost/~rilakkuma3xjapan/portfolio-x-sound-server/php/bootstrap.php":
"http://curtaincall.weblike.jp/portfolio-x-sound-server/php/bootstrap.php";var m=n(),p=function(){a.isDisabled=!0;c({method:"POST",url:q+"/account/delete",timeout:1E4,withCredentials:!0,params:"",data:{username:a.deleteAccounts.username,password:a.deleteAccounts.password,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(a){return $.param(a)}}).success(function(b,c,e,d){angular.isObject(b)&&(a.csrf=b.csrf,a.isAuth=b.isAuth,a.authedUsername=
b.username,a.isAuth?angular.forEach(b.message,function(a){g("Error",400,"auto",!1,"<p><b>"+a+"</b></p>")}):angular.forEach(b.message,function(a){g("Confirmation",400,"auto",!1,"<p><b>"+a+"</b></p>")}));a.isDisabled=!1}).error(function(b,c,e,d){t();a.isDisabled=!1})},r=function(b,c){if(angular.isObject(b)){var e=function(a,b){angular.forEach(l,function(d){X(d).module(a).state(b)});C("oscillator").module(a).state(b);b?$('[effector="'+a+'"]').addClass("check-on"):$('[effector="'+a+'"]').removeClass("check-on")};
"mastervolume"in b&&$(".slider-masterVolume:not(:first)").slider("value",b.mastervolume);if("glide"in b){var d=b.glide;"time"in d&&$(".slider-glide-time").slider("value",d.time)}"eg"in b&&(d=b.eg,"attack"in d&&$(".slider-eg-attack").slider("value",d.attack),"decay"in d&&$(".slider-eg-decay").slider("value",d.decay),"sustain"in d&&$(".slider-eg-sustain").slider("value",d.sustain),"release"in d&&$(".slider-eg-release").slider("value",d.release));if("oscillator0"in b){var f=b.oscillator0;"state"in f&&
h(function(){a.$parent.oscillators.oscillator0.isActive=!f;a.$parent.toggleOscillatorState(null,0)});"type"in f&&h(function(){a.$parent.changeWaveType(null,0,f.type)});"gain"in f&&$(".slider-volume:first").slider("value",f.gain);"octave"in f&&$(".slider-octave:first").slider("value",f.octave);"fine"in f&&$(".slider-fine:first").slider("value",f.fine)}if("oscillator1"in b){var g=b.oscillator1;"state"in g&&h(function(){a.$parent.oscillators.oscillator1.isActive=!g;a.$parent.toggleOscillatorState(null,
1)});"type"in g&&h(function(){a.$parent.changeWaveType(null,1,g.type)});"gain"in g&&$(".slider-volume:last").slider("value",g.gain);"octave"in g&&$(".slider-octave:last").slider("value",g.octave);"fine"in g&&$(".slider-fine:last").slider("value",g.fine)}"compressor"in b&&(d=b.compressor,"state"in d&&e("compressor",d.state),"threshold"in d&&$(".slider-threshold").slider("value",d.threshold),"knee"in d&&$(".slider-knee").slider("value",d.knee),"ratio"in d&&$(".slider-ratio").slider("value",d.ratio),
"attack"in d&&$(".slider-compressor-attack").slider("value",d.attack),"release"in d&&$(".slider-compressor-release").slider("value",d.release));"distortion"in b&&(d=b.distortion,"state"in d&&e("distortion",d.state),"curve"in d&&$("#select-distortion-type").val(d.curve).trigger("change"),"samples"in d&&$("#select-distortion-sample").val("value",d.samples),"drive"in d&&$(".slider-distortion-drive").slider("value",d.drive),"color"in d&&$(".slider-distortion-color").slider("value",d.color),"tone"in d&&
$(".slider-distortion-tone").slider("value",d.tone));"wah"in b&&(d=b.wah,"state"in d&&e("wah",d.state),"cutoff"in d&&$(".slider-wah-cutoff").slider("value",d.cutoff),"depth"in d&&$(".slider-wah-depth").slider("value",d.depth),"rate"in d&&$(".slider-wah-rate").slider("value",d.rate),"resonance"in d&&$(".slider-wah-resonance").slider("value",d.resonance));"equalizer"in b&&(d=b.equalizer,"state"in d&&e("equalizer",d.state),"bass"in d&&$(".slider-equalizer-bass").slider("value",d.bass),"middle"in d&&
$(".slider-equalizer-middle").slider("value",d.middle),"treble"in d&&$(".slider-equalizer-treble").slider("value",d.treble),"presence"in d&&$(".slider-equalizer-presence").slider("value",d.presence));"filter"in b&&(d=b.filter,"state"in d&&e("filter",d.state),"type"in d&&$("#select-filter-type").val(d.type).trigger("change"),"frequency"in d&&$(".slider-filter-cutoff").slider("value",d.frequency),"Q"in d&&$(".slider-filter-Q").slider("value",d.Q),"gain"in d&&$(".slider-filter-gain").slider("value",
d.gain),"attack"in d&&$(".slider-filter-attack").slider("value",d.attack),"decay"in d&&$(".slider-filter-decay").slider("value",d.decay),"sustain"in d&&$(".slider-filter-sustain").slider("value",d.sustain),"release"in d&&$(".slider-filter-release").slider("value",d.release));"autopanner"in b&&(d=b.autopanner,"state"in d&&e("autopanner",d.state),"depth"in d&&$(".slider-autopanner-depth").slider("value",d.depth),"rate"in d&&$(".slider-autopanner-rate").slider("value",d.rate));"tremolo"in b&&(d=b.tremolo,
"state"in d&&e("tremolo",d.state),"depth"in d&&$(".slider-tremolo-depth").slider("value",d.depth),"rate"in d&&$(".slider-tremolo-rate").slider("value",d.rate));"ringmodulator"in b&&(d=b.ringmodulator,"state"in d&&e("ringmodulator",d.state),"depth"in d&&$(".slider-ringmodulator-depth").slider("value",d.depth),"rate"in d&&$(".slider-ringmodulator-rate").slider("value",d.rate));"phaser"in b&&(d=b.phaser,"state"in d&&e("phaser",d.state),"stage"in d&&$(".select-phaser-stage").val(d.stage),"frequency"in
d&&$(".slider-phaser-cutoff").slider("value",d.frequency),"depth"in d&&$(".slider-phaser-depth").slider("value",d.depth),"rate"in d&&$(".slider-phaser-rate").slider("value",d.rate),"mix"in d&&$(".slider-phaser-mix").slider("value",d.mix),"feedback"in d&&$(".slider-phaser-feedback").slider("value",d.feedback));"flanger"in b&&(d=b.flanger,"state"in d&&e("flanger",d.state),"time"in d&&$(".slider-flanger-time").slider("value",d.time),"depth"in d&&$(".slider-flanger-depth").slider("value",d.depth),"rate"in
d&&$(".slider-flanger-rate").slider("value",d.rate),"mix"in d&&$(".slider-flanger-mix").slider("value",d.mix),"tone"in d&&$(".slider-flanger-tone").slider("value",d.tone),"feedback"in d&&$(".slider-flanger-feedback").slider("value",d.feedback));"chorus"in b&&(d=b.chorus,"state"in d&&e("chorus",d.state),"time"in d&&$(".slider-chorus-time").slider("value",d.time),"depth"in d&&$(".slider-chorus-depth").slider("value",d.depth),"rate"in d&&$(".slider-chorus-rate").slider("value",d.rate),"mix"in d&&$(".slider-chorus-mix").slider("value",
d.mix),"tone"in d&&$(".slider-chorus-tone").slider("value",d.tone),"feedback"in d&&$(".slider-chorus-feedback").slider("value",d.feedback));"delay"in b&&(d=b.delay,"state"in d&&e("delay",d.state),"time"in d&&$(".slider-delay-time").slider("value",d.time),"dry"in d&&$(".slider-delay-dry").slider("value",d.dry),"wet"in d&&$(".slider-delay-wet").slider("value",d.wet),"tone"in d&&$(".slider-delay-tone").slider("value",d.tone),"feedback"in d&&$(".slider-delay-feedback").slider("value",d.feedback));"reverb"in
b&&(d=b.reverb,"state"in d&&e("reverb",d.state),"dry"in d&&$(".slider-reverb-dry").slider("value",d.dry),"wet"in d&&$(".slider-reverb-wet").slider("value",d.wet),"tone"in d&&$(".slider-reverb-tone").slider("value",d.tone));h(function(){a.currentPatches=n();c&&history.pushState(n(),null)})}},u=function(b){c({method:"POST",url:q+"/patch/update",timeout:1E4,withCredentials:!0,params:"",data:{name:b,patch:angular.toJson(n()),_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},
transformRequest:function(a){return $.param(a)}}).success(function(b,c,d,e){h(function(){angular.isObject(b)&&(a.csrf=b.csrf,a.isAuth=b.isAuth,a.patchLists=angular.fromJson(b.patches),angular.forEach(b.message,function(a){g("Confirmation",500,"auto",!1,"<p><b>"+a+"</b></p>")}))})}).error(function(a,b,d,c){t()})},v=function(b){c({method:"POST",url:q+"/patch/delete",timeout:1E4,withCredentials:!0,params:"",data:{name:b,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},
transformRequest:function(a){return $.param(a)}}).success(function(b,c,d,e){angular.isObject(b)&&(a.csrf=b.csrf,a.isAuth=b.isAuth,a.patchLists=angular.fromJson(b.patches),angular.forEach(b.message,function(a){g("Confirmation",500,"auto",!1,"<p><b>"+a+"</b></p>")}))}).error(function(a,b,d,c){t()})},t=function(){g("Error",500,"auto",!1,"<p><b>Connection to Server failed.</b></p>")};f.onpopstate=function(a){a.state?r(a.state,!1):r(m,!1)};a.isAuth=!1;a.isSignin=!0;a.isSignup=!1;a.isPatchList=!1;a.isSavePath=
!1;a.isAccount=!1;a.isDisabled=!1;a.csrf="";a.signups={username:"",password:""};a.signins={username:"",password:""};a.deleteAccounts={username:"",password:""};a.authedUsername="";a.patchname="";a.patchLists=[];a.dialogPatchDetailId="dialog-patch-detail";a.isShowDialogPatchDetail=!1;a.$watch(function(){return a.isAuth},function(b){b?(a.signups={username:"",password:""},a.signins={username:"",password:""},a.currentPatches=n(),a.toggleAction(null,"patchList")):(a.deleteAccounts={username:"",password:""},
a.currentPatches={},a.patches={},a.patchname="",a.patchLists=[],a.authedUsername="",a.isShowDialogPatchDetail=!1,a.toggleAction(null,"signin"))});a.$on("onOpenPatchDialog",function(b){a.currentPatches=n()});a.cancelClose=function(a){a.stopImmediatePropagation()};a.toggleAction=function(b,c){null!==b&&b.preventDefault();a.isSignin=!1;a.isSignup=!1;a.isPatchList=!1;a.isSavePatch=!1;a.isAccount=!1;switch(c){case "signin":a.isSignin=!0;break;case "signup":a.isSignup=!0;break;case "patchList":a.isPatchList=
!0;break;case "savePatch":a.isSavePatch=!0;break;case "account":a.isAccount=!0}};a.signin=function(b){a.isDisabled=!0;c({method:"POST",url:q+"/account/signin",timeout:1E4,withCredentials:!0,params:"",data:{username:a.signins.username,password:a.signins.password,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(a){return $.param(a)}}).success(function(b,c,d,e){angular.isObject(b)&&(a.csrf=b.csrf,a.isAuth=b.isAuth,a.authedUsername=b.username,
a.isAuth?a.patchLists=angular.fromJson(b.patches):angular.forEach(b.message,function(a){g("Error",500,"auto",!1,"<p><b>"+a+"</b></p>")}));a.isDisabled=!1}).error(function(b,c,d,e){t();a.isDisabled=!1})};a.signup=function(b){a.isDisabled=!0;c({method:"POST",url:q+"/account/signup",timeout:1E4,withCredentials:!0,params:"",data:{username:a.signups.username,password:a.signups.password,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(a){return $.param(a)}}).success(function(b,
c,d,e){angular.isObject(b)&&(a.csrf=b.csrf,a.isAuth=b.isAuth,a.authedUsername=b.username,a.isAuth?angular.forEach(b.message,function(a){g("Confirmation",600,"auto",!1,"<p><b>"+a+"</b></p>")}):angular.forEach(b.message,function(a){g("Error",500,"auto",!1,"<p><b>"+a+"</b></p>")}));a.isDisabled=!1}).error(function(b,c,d,e){t();a.isDisabled=!1})};a.signout=function(b){a.isDisabled=!0;c({method:"POST",url:q+"/account/signout",timeout:1E4,withCredentials:!0,params:"",data:{_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},
transformRequest:function(a){return $.param(a)}}).success(function(b,c,d,e){angular.isObject(b)&&(a.csrf=b.csrf,a.isAuth=b.isAuth,a.authedUsername=b.username);a.isDisabled=!1}).error(function(b,c,d,e){t();a.isDisabled=!1})};a.deleteAccount=function(a){$("<div />").html('<p><b>Delete your account. OK ?<br /> <b class="dangerous">If you delete account, the all of patches that you saved are also deleted.</b></b></p>').dialog({title:"Confirmation",autoOpen:!0,show:"bounce",hide:"explode",modal:!1,width:650,
height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){p();$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})};a.typePatchname=function(b){a.patchname=b.currentTarget.value};a.savePatch=function(b){a.isDisabled=!0;c({method:"POST",url:q+"/patch/add",timeout:1E4,withCredentials:!0,params:"",data:{name:a.patchname,patch:angular.toJson(n()),_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},
transformRequest:function(a){return $.param(a)}}).success(function(b,c,d,e){angular.isObject(b)&&(a.csrf=b.csrf,a.isAuth=b.isAuth,angular.forEach(b.message,function(a){g("Confirmation",500,"auto",!1,"<p><b>"+a+"</b></p>")}),b.result&&(a.patchLists=angular.fromJson(b.patches)));a.isDisabled=!1}).error(function(b,c,d,e){t();a.isDisabled=!1})};a.openPatchDetail=function(b,c){if(angular.isObject(c)&&angular.isObject(c.patch))a.patches=c.patch;else if(angular.isString(c.patch)){var e=c.patch.replace(/&quot;/g,
'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&");a.patches=angular.fromJson(e)}else return;a.isShowDialogPatchDetail=!0;$("#"+a.dialogPatchDetailId).dialog({title:c.name,autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:600,height:400,draggable:!0,resizable:!1,zIndex:9999,position:{my:"center top",at:"center top"},buttons:{LOAD:function(){r(a.patches,!0);$(this).dialog("close")},UPDATE:function(){$("<div />").html("<p><b>Update the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,
show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:1E4,buttons:{OK:function(){u(c.name);$(this).dialog("close").dialog("destroy").remove();$("#"+a.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},DELETE:function(){$("<div />").html("<p><b>Delete the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,
zIndex:1E4,buttons:{OK:function(){v(c.name);$(this).dialog("close").dialog("destroy").remove();$("#"+a.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},CLOSE:function(){$(this).dialog("close")}},close:function(b,c){$(this).dialog("destroy");h(function(){a.isShowDialogPatchDetail=!1})}})};c({method:"GET",url:q,timeout:1E4,withCredentials:!0,params:"",headers:{}}).success(function(b,c,e,d){angular.isObject(b)&&b.result&&(a.isAuth=b.isAuth,
a.csrf=b.csrf,a.authedUsername=b.username,a.isAuth&&(a.patchLists=angular.fromJson(b.patches)))}).error(function(a,b,c,d){t()})}])})();